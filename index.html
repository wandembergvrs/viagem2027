<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Viagem de Fam√≠lia 2027 - Marcopolo G8 Dirontur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet (mapa interativo) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --bg: #f3f4f6;
      --bg-soft: #e5e7eb;
      --card: #ffffff;
      --accent: #facc15;
      --accent-soft: #22c55e;
      --accent-dark: #15803d;
      --text: #0f172a;
      --text-muted: #6b7280;
      --border: #d1d5db;
      --danger: #ea580c;
      --radius-xl: 18px;
      --shadow-soft: 0 12px 24px rgba(15, 23, 42, 0.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: linear-gradient(180deg, #e5e7eb 0, #f9fafb 45%, #e5e7eb 100%);
      color: var(--text);
      min-height: 100vh;
    }

    a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 600;
    }

    a:hover { text-decoration: underline; }

    header {
      position: relative;
      overflow: hidden;
      border-bottom: 1px solid rgba(148, 163, 184, 0.45);
      background: linear-gradient(
        135deg,
        #facc15 0%,
        #22c55e 40%,
        #e5e7eb 85%
      );
      color: #020617;
    }

    .hero {
      max-width: 900px;
      margin: 0 auto;
      padding: 18px 14px 22px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 16px;
      align-items: center;
    }

    @media (max-width: 768px) {
      .hero { grid-template-columns: 1fr; }
    }

    .hero-title {
      font-size: clamp(1.8rem, 4.2vw, 2.4rem);
      font-weight: 800;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .hero-subtitle {
      font-size: 0.92rem;
      max-width: 520px;
    }

    .hero-countdown {
      margin-top: 12px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(248, 250, 252, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.65);
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 0.86rem;
      color: #020617;
      max-width: 520px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.18);
    }

    .hero-countdown-line {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: baseline;
      justify-content: space-between;
    }

    .hero-countdown-line strong { font-size: 1.2rem; }

    .hero-countdown-sub {
      font-size: 0.78rem;
      color: #334155;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
      font-size: 0.75rem;
    }

    .badge {
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.12);
      background: rgba(248, 250, 252, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #1f2937;
    }

    .hero-bus {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      display: flex;
      align-items: flex-end;
      justify-content: flex-end;
      background: radial-gradient(
        circle at 20% 0,
        #eab308 0,
        #0f172a 40%,
        #020617 100%
      );
      min-height: 180px;
    }

    .hero-bus img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    .hero-bus-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at 20% 0,
        transparent 0%,
        rgba(15, 23, 42, 0.6) 40%,
        rgba(15, 23, 42, 0.8) 100%
      );
    }

    .hero-bus-caption {
      position: absolute;
      left: 12px;
      bottom: 12px;
      background: rgba(15, 23, 42, 0.85);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.72rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    .hero-bus-caption strong { color: var(--accent); }

    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 14px 10px 22px;
    }

    section { margin-bottom: 14px; }

    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      padding: 12px 12px 10px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -120px;
      background: radial-gradient(
        circle at 0 0,
        rgba(250, 204, 21, 0.08),
        transparent 55%
      );
      pointer-events: none;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 700;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.icon {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      background: rgba(250, 204, 21, 0.18);
      border: 1px solid rgba(250, 204, 21, 0.5);
      font-size: 0.86rem;
    }

    .card-subtitle {
      font-size: 0.76rem;
      color: var(--text-muted);
      position: relative;
      z-index: 1;
    }

    .pill {
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(248, 250, 252, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: var(--text-muted);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-soft);
    }

    .pill-dot.warn { background: var(--danger); }

    .stats-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin: 8px 0;
      font-size: 0.8rem;
      position: relative;
      z-index: 1;
    }

    .stats-row div small {
      display: block;
      color: var(--text-muted);
      font-size: 0.72rem;
      margin-bottom: 1px;
    }

    .stats-row div strong { font-size: 0.86rem; }

    .progress-container {
      margin-top: 4px;
      position: relative;
      z-index: 1;
    }

    .progress-track {
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.75);
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(203, 213, 225, 0.5);
      position: relative;
    }

    .progress-fill {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(
        90deg,
        var(--accent-soft),
        var(--accent),
        #f97316
      );
      width: 0%;
      transition: width 0.8s ease-out;
      box-shadow: 0 0 10px rgba(250, 204, 21, 0.6);
      position: relative;
    }

    .progress-marker {
      position: absolute;
      top: -2px;
      right: 0;
      transform: translateX(50%);
      width: 4px;
      height: 16px;
      border-radius: 999px;
      background: #ffffff;
      border: 1px solid rgba(148, 163, 184, 0.85);
      box-shadow: 0 0 10px rgba(148, 163, 184, 0.8);
    }

    .progress-label {
      margin-top: 4px;
      font-size: 0.74rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .progress-label strong {
      color: var(--accent-dark);
      font-size: 0.82rem;
    }

    .info-list {
      list-style: none;
      padding-left: 0;
      margin: 4px 0 2px;
      font-size: 0.82rem;
      position: relative;
      z-index: 1;
    }

    .info-list li {
      padding: 3px 0;
      display: flex;
      gap: 6px;
      align-items: baseline;
    }

    .info-list li::before {
      content: "‚Ä¢";
      color: var(--accent-soft);
      margin-right: 4px;
      font-size: 0.9rem;
    }

    .info-highlight {
      margin-top: 3px;
      font-size: 0.76rem;
      color: var(--text-muted);
    }

    .passenger-summary {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.76rem;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    .passenger-summary span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 7px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      color: var(--text-muted);
    }

    .table-wrapper {
      max-height: 340px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      position: relative;
      z-index: 1;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      min-width: 360px;
    }

    thead {
      position: sticky;
      top: 0;
      background: #f3f4f6;
      z-index: 2;
      box-shadow: 0 2px 0 rgba(209, 213, 219, 0.9);
    }

    th,
    td {
      padding: 6px 8px;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      border-bottom: 1px solid #e5e7eb;
    }

    tbody tr:nth-child(even) { background: #f9fafb; }
    tbody tr:nth-child(odd) { background: #ffffff; }

    tbody tr:hover { background: #eef2ff; }

    td {
      border-bottom: 1px solid #e5e7eb;
      color: var(--text);
    }

    td.status { font-size: 0.76rem; }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
    }

    .status-pill.paid {
      border-color: rgba(34, 197, 94, 0.7);
      color: #14532d;
      background: #ecfdf3;
    }

    .status-pill.pending {
      border-color: rgba(249, 115, 22, 0.7);
      color: #7c2d12;
      background: #fff7ed;
    }

    .status-pill span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-soft);
    }

    .status-pill.pending span.dot { background: var(--danger); }

    #trip-map {
      width: 100%;
      height: 260px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      margin-top: 4px;
    }

    .map-note {
      font-size: 0.74rem;
      color: var(--text-muted);
      margin-top: 5px;
      position: relative;
      z-index: 1;
    }

    .seat-controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px;
      font-size: 0.76rem;
      margin: 4px 0 8px;
      position: relative;
      z-index: 1;
    }

    .seat-controls label { font-weight: 600; }

    .seat-select {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      font-size: 0.76rem;
    }

    .seat-helper {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .seat-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .deck {
      padding: 6px 8px 8px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }

    .deck-header {
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .deck-header span {
      font-weight: 600;
      color: var(--text);
    }

    .seat-grid {
      display: grid;
      grid-auto-rows: 28px;
      gap: 4px;
      justify-content: center;
      margin-top: 2px;
    }

    #seat-grid-upper {
      grid-template-columns: repeat(4, 28px); /* 2 + corredor + 2 */
    }

    #seat-grid-lower {
      grid-template-columns: repeat(4, 28px);
    }

    .seat {
      width: 28px;
      height: 28px;
      border-radius: 7px;
      border: 1px solid #d1d5db;
      font-size: 0.66rem;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
        background 0.12s ease-out, border-color 0.12s ease-out;
    }

    .seat.free { background: #f3f4f6; }

    .seat.occupied {
      background: #22c55e;
      color: #022c22;
      border-color: #16a34a;
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.4);
    }

    .seat.mine { box-shadow: 0 0 0 2px #0ea5e9; }

    .seat:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(15, 23, 42, 0.16);
    }

    .seat:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .seat-gap {
      width: 28px;
      height: 28px;
    }

    .seat-legend {
      margin-top: 6px;
      font-size: 0.72rem;
      color: var(--text-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      background: #f3f4f6;
    }

    .legend-color.occupied {
      background: #22c55e;
      border-color: #16a34a;
    }

    .legend-color.mine {
      background: #22c55e;
      border-color: #0ea5e9;
      box-shadow: 0 0 0 2px #0ea5e9;
    }

    footer {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 10px 14px;
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
    }
  </style>
</head>
<body>
  <header>
    <div class="hero">
      <div>
        <div class="hero-title">Viagem de Fam√≠lia 2027</div>
        <p class="hero-subtitle">
          Uma viagem tranquila e divertida em fam√≠lia a bordo de um
          <strong>Marcopolo G8 da empresa Dirontur</strong>.
          Veja a foto do √¥nibus
          <a href="dirontur-marcopolo-g8.jpg" target="_blank" rel="noopener noreferrer">
            clicando aqui
          </a>.
        </p>

        <div class="hero-countdown">
          <div class="hero-countdown-line">
            <span>Fam√≠lia! üéâüöç</span>
            <span>
              Faltam <strong id="hero-days-remaining">394</strong> dias para a nossa viagem!
            </span>
          </div>
          <div class="hero-countdown-sub">
            Per√≠odo: <span id="hero-trip-period">08 a 23/01/2027</span>
          </div>
        </div>

        <div class="hero-badges">
          <div class="badge">üöå Marcopolo G8 Dirontur</div>
          <div class="badge">
            üë®‚Äçüë©‚Äçüëß‚Äçüë¶ <span id="hero-badge-people">‚Äì passageiros</span>
          </div>
          <div class="badge">
            üßë Adultos &nbsp;|&nbsp; üßí Crian√ßas &nbsp;|&nbsp; üë∂ Colo
          </div>
        </div>
      </div>

      <div class="hero-bus">
        <img
          src="dirontur-marcopolo-g8.jpg"
          alt="√înibus Marcopolo G8 da empresa Dirontur"
        />
        <div class="hero-bus-overlay"></div>
        <div class="hero-bus-caption">
          <span>üõ£Ô∏è</span>
          <span><strong>Marcopolo G8 Dirontur</strong> ‚Äî estrada, hist√≥rias e boas companhias</span>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- INFORMA√á√ïES DA VIAGEM -->
    <section class="card" id="trip-info-card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">üìå</span>
            Informa√ß√µes da viagem
          </div>
          <p class="card-subtitle">
            Per√≠odo, valor por poltrona, regra das crian√ßas e vis√£o geral.
          </p>
        </div>
      </div>

      <ul class="info-list">
        <li>
          <strong>Per√≠odo:</strong>
          <span id="info-period">08 a 23/01/2027</span>
        </li>
        <li>
          <strong>Valor por pessoa (poltrona):</strong>
          <span id="info-fare">R$ 1.100,00</span>
        </li>
        <li>
          <strong>Parcelamento:</strong>
          at√© <span id="info-installments">10x</span>, com parcelas a partir de
          <span id="info-installment-value">R$ 110,00</span>, come√ßando em dezembro.
        </li>
        <li>
          <strong>Crian√ßas at√© 5 anos:</strong>
          n√£o pagam e v√£o no colo do respons√°vel (sem poltrona marcada).
        </li>
        <li>
          <strong>Resumo:</strong>
          <span id="info-paying-people">‚Äì</span> poltronas pagantes,
          <span id="info-started-people">‚Äì</span> com pagamento iniciado e
          <span id="info-full-people">‚Äì</span> totalmente quitado(s).
        </li>
      </ul>

      <div class="info-highlight">
        As poltronas ser√£o marcadas somente ap√≥s a quita√ß√£o de todas as parcelas de cada passageiro.
      </div>
    </section>

    <!-- PAGAMENTO -->
    <section class="card" id="payment-card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">üí≥</span>
            Pagamento da viagem
          </div>
          <p class="card-subtitle">
            Acompanhamento geral das parcelas da fam√≠lia. Nenhum valor individual √© exibido.
          </p>
        </div>
        <div class="pill">
          <span class="pill-dot"></span>
          Vis√£o consolidada da fam√≠lia
        </div>
      </div>

      <div class="stats-row">
        <div>
          <small>Pagamentos iniciados</small>
          <strong id="stats-started-people">0 / 0</strong>
        </div>
        <div>
          <small>Passageiros quitados</small>
          <strong id="stats-full-people">0</strong>
        </div>
        <div>
          <small>Progresso geral pago</small>
          <strong id="stats-percent-small">0%</strong>
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-track">
          <div id="payment-progress-fill" class="progress-fill"></div>
          <div class="progress-marker"></div>
        </div>
        <div class="progress-label">
          <span>Percentual das parcelas j√° pagas (sobre o total planejado)</span>
          <strong id="payment-percent-label">0%</strong>
        </div>
      </div>
    </section>

    <!-- TEMPO -->
    <section class="card" id="time-card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">‚è≥</span>
            Contagem para o embarque
          </div>
          <p class="card-subtitle">
            Progresso do tempo entre o in√≠cio do planejamento e o dia da viagem.
          </p>
        </div>
        <div class="pill">
          <span class="pill-dot warn"></span>
          Assentos s√≥ ap√≥s quita√ß√£o
        </div>
      </div>

      <div class="stats-row">
        <div>
          <small>Datas da viagem</small>
          <strong id="trip-date-label">‚Äì</strong>
        </div>
        <div>
          <small>Dias que faltam</small>
          <strong id="days-remaining-label">‚Äì</strong>
        </div>
        <div>
          <small>Planejamento</small>
          <strong id="planning-window-label">‚Äì</strong>
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-track">
          <div id="time-progress-fill" class="progress-fill"></div>
          <div class="progress-marker"></div>
        </div>
        <div class="progress-label">
          <span>Tempo decorrido at√© a viagem</span>
          <strong id="time-percent-label">0%</strong>
        </div>
      </div>
    </section>

    <!-- MAPA DA ROTA -->
    <section class="card" id="map-card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">üó∫Ô∏è</span>
            Rota da viagem
          </div>
          <p class="card-subtitle">
            Bras√≠lia ‚Üí Fortaleza ‚Üí Bom Sucesso (PB) ‚Üí Macei√≥ ‚Üí Bras√≠lia.
          </p>
        </div>
      </div>

      <div id="trip-map"></div>

      <div class="map-note">
        ‚Ä¢ 08/01/2027 ‚Ä¢ 18h ‚Äî sa√≠da de Bras√≠lia (DF) para Fortaleza (CE)<br />
        ‚Ä¢ 13/01/2027 ‚Äî Fortaleza (CE) ‚Üí Bom Sucesso (PB)<br />
        ‚Ä¢ 17/01/2027 ‚Äî Bom Sucesso (PB) ‚Üí Macei√≥ (AL)<br />
        ‚Ä¢ 22/01/2027 ‚Äî sa√≠da de Macei√≥ (AL) para Bras√≠lia (DF)
      </div>
    </section>

    <!-- PASSAGEIROS -->
    <section class="card" id="passengers-card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">üßæ</span>
            Lista de passageiros
          </div>
          <p class="card-subtitle">
            Nomes e situa√ß√£o geral. Parcelas s√£o ajustadas na planilha
            <code>passageiros.csv</code>.
          </p>
        </div>
      </div>

      <div class="passenger-summary" id="passenger-summary"></div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Passageiro(a)</th>
              <th>Perfil</th>
              <th>Situa√ß√£o</th>
              <th>Parcelas</th>
              <th>Assento</th>
            </tr>
          </thead>
          <tbody id="passenger-table-body"></tbody>
        </table>
      </div>
    </section>

    <!-- LAYOUT DE ASSENTOS -->
    <section class="card" id="seat-layout-card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="icon">ü™ë</span>
            Mapa de assentos - Marcopolo G8
          </div>
          <p class="card-subtitle">
            Piso superior: poltronas 1‚Äì48. Piso inferior: 49‚Äì57.
            Apenas passageiros quitados podem escolher poltrona.
          </p>
        </div>
      </div>

      <div class="seat-controls">
        <label for="seat-passenger-select">Passageiro quitado:</label>
        <select id="seat-passenger-select" class="seat-select">
          <option value="">Nenhum selecionado</option>
        </select>
        <span class="seat-helper" id="seat-helper-text">
          Ainda n√£o h√° passageiros totalmente quitados.
        </span>
      </div>

      <div class="seat-layout">
        <div class="deck">
          <div class="deck-header">
            <span>Piso superior</span>
            <span>Poltronas 1‚Äì48</span>
          </div>
          <div class="seat-grid" id="seat-grid-upper"></div>
        </div>

        <div class="deck">
          <div class="deck-header">
            <span>Piso inferior</span>
            <span>Poltronas 49‚Äì57</span>
          </div>
          <div class="seat-grid" id="seat-grid-lower"></div>
        </div>
      </div>

      <div class="seat-legend">
        <div class="legend-item">
          <span class="legend-color"></span>
          Livre
        </div>
        <div class="legend-item">
          <span class="legend-color occupied"></span>
          Ocupado
        </div>
        <div class="legend-item">
          <span class="legend-color mine"></span>
          Poltrona do passageiro selecionado
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div>
      Site privado para organizar a viagem da fam√≠lia, mostrando apenas o andamento coletivo.
    </div>
    <div>
      Parcelas s√£o ajustadas na planilha; assentos s√£o escolhidos aqui ap√≥s quita√ß√£o.
    </div>
  </footer>

  <script>
    // ===============================
    // CONFIGURA√á√ïES
    // ===============================

    const TRIP_START_DATE = new Date("2027-01-08T00:00:00");
    const TRIP_END_DATE = new Date("2027-01-23T00:00:00");
    const PLANNING_START_DATE = new Date("2025-12-09T00:00:00");

    const FARE_PER_PERSON = 1100.0;
    const MAX_INSTALLMENTS = 10;
    const TRIP_TOTAL_VALUE = 59400.0; // apenas para c√°lculo do %

    const STORAGE_KEY = "viagemFamilia2027Seats";

    const msPerDay = 1000 * 60 * 60 * 24;
    const clamp = (n, min, max) => Math.min(Math.max(n, min), max);

    const brCurrency = (value) =>
      value.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });

    // ===============================
    // PASSAGEIROS (carregados via CSV)
    // ===============================

    let passengers = [];

    // carrega passageiros do arquivo passageiros.csv
    async function loadPassengersFromCSV() {
      const response = await fetch("passageiros.csv");
      if (!response.ok) {
        throw new Error("N√£o foi poss√≠vel carregar passageiros.csv");
      }
      const text = await response.text();
      passengers = parsePassengersCSV(text);
    }

    // converte texto CSV em array de passageiros
    function parsePassengersCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      if (!lines.length) return [];

      const headerLine = lines.shift();
      const delimiter = headerLine.includes(";") ? ";" : ",";
      const headers = headerLine
        .split(delimiter)
        .map((h) => h.trim().toLowerCase());

      const idxNome = headers.indexOf("nome");
      const idxCategoria = headers.indexOf("categoria");
      const idxParcelas = headers.indexOf("parcelas");

      if (idxNome === -1 || idxCategoria === -1 || idxParcelas === -1) {
        console.error(
          "Cabe√ßalho do passageiros.csv deve ter: Nome;Categoria;Parcelas"
        );
        return [];
      }

      return lines
        .filter((l) => l.trim())
        .map((line) => {
          const cols = line.split(delimiter).map((c) => c.trim());

          const nome = cols[idxNome] || "Sem nome";
          const catCsv = (cols[idxCategoria] || "adulto").toLowerCase();
          const parcelas = Number(cols[idxParcelas] || 0) || 0;

          let category = "adult";
          if (catCsv.startsWith("crianca_colo")) {
            category = "childLap";
          } else if (catCsv.startsWith("crianca_poltrona")) {
            category = "childSeat";
          } else {
            category = "adult";
          }

          return {
            name: nome,
            category,
            seatType: category === "childLap" ? "Colo" : "Poltrona",
            installmentsPaid: parcelas,
            seat: "",
          };
        });
    }

    // ===============================
    // STORAGE (assentos apenas)
    // ===============================

    function loadPassengersFromStorage() {
      if (typeof localStorage === "undefined") return;
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return;
        parsed.forEach((stored, idx) => {
          if (!passengers[idx]) return;
          if (stored.seat !== undefined) {
            passengers[idx].seat = stored.seat ? String(stored.seat) : "";
          }
        });
      } catch (e) {
        console.warn("N√£o foi poss√≠vel carregar assentos salvos:", e);
      }
    }

    function savePassengersToStorage() {
      if (typeof localStorage === "undefined") return;
      try {
        const payload = passengers.map((p) => ({
          seat: p.seat || "",
        }));
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      } catch (e) {
        console.warn("N√£o foi poss√≠vel salvar assentos:", e);
      }
    }

    // ===============================
    // AUXILIARES DE PAGAMENTO
    // ===============================

    function getInstallments(p) {
      const v = Number(p.installmentsPaid);
      if (!Number.isFinite(v) || v < 0) return 0;
      return clamp(v, 0, MAX_INSTALLMENTS);
    }

    const getPayingPassengersCount = () =>
      passengers.filter((p) => p.seatType !== "Colo").length;

    const getStartedPassengersCount = () =>
      passengers.filter((p) => getInstallments(p) > 0).length;

    const getFullPassengersCount = () =>
      passengers.filter((p) => getInstallments(p) >= MAX_INSTALLMENTS).length;

    function getTripPaidValue() {
      return passengers.reduce((sum, p) => {
        if (p.seatType === "Colo") return sum;
        const inst = getInstallments(p);
        const share = (inst / MAX_INSTALLMENTS) * FARE_PER_PERSON;
        return sum + share;
      }, 0);
    }

    function getPassengerIcon(p) {
      if (p.category === "childLap") return "üë∂";
      if (p.category === "childSeat") return "üßí";
      return "üßë";
    }

    // ===============================
    // HERO & INFO
    // ===============================

    function updateHero() {
      const heroBadgePeople = document.getElementById("hero-badge-people");
      const heroDays = document.getElementById("hero-days-remaining");
      const heroPeriod = document.getElementById("hero-trip-period");

      const totalPassengers = passengers.length;
      const lapCount = passengers.filter((p) => p.category === "childLap").length;
      const seatCount = totalPassengers - lapCount;

      heroBadgePeople.textContent = `${totalPassengers} passageiros ‚Ä¢ ${seatCount} poltronas + ${lapCount} no colo`;

      const today = new Date();
      const rawRemaining = (TRIP_START_DATE - today) / msPerDay;
      const remainingDays = Math.max(Math.ceil(rawRemaining), 0);
      heroDays.textContent = remainingDays;

      heroPeriod.textContent =
        TRIP_START_DATE.toLocaleDateString("pt-BR") +
        " a " +
        TRIP_END_DATE.toLocaleDateString("pt-BR");
    }

    function updateTripInfoCard() {
      const infoPeriod = document.getElementById("info-period");
      const infoFare = document.getElementById("info-fare");
      const infoInstallments = document.getElementById("info-installments");
      const infoInstallmentValue = document.getElementById(
        "info-installment-value"
      );
      const infoPayingPeople = document.getElementById("info-paying-people");
      const infoStartedPeople = document.getElementById("info-started-people");
      const infoFullPeople = document.getElementById("info-full-people");

      const payingCount = getPayingPassengersCount();
      const startedCount = getStartedPassengersCount();
      const fullCount = getFullPassengersCount();

      infoPeriod.textContent =
        TRIP_START_DATE.toLocaleDateString("pt-BR") +
        " a " +
        TRIP_END_DATE.toLocaleDateString("pt-BR");

      infoFare.textContent = brCurrency(FARE_PER_PERSON);
      infoInstallments.textContent = `${MAX_INSTALLMENTS}x`;
      infoInstallmentValue.textContent = brCurrency(
        FARE_PER_PERSON / MAX_INSTALLMENTS
      );

      infoPayingPeople.textContent = `${payingCount}`;
      infoStartedPeople.textContent = `${startedCount}`;
      infoFullPeople.textContent = `${fullCount}`;
    }

    // ===============================
    // PAGAMENTO & TEMPO
    // ===============================

    function updatePaymentPanel() {
      const startedLabel = document.getElementById("stats-started-people");
      const fullLabel = document.getElementById("stats-full-people");
      const smallPercentLabel = document.getElementById("stats-percent-small");
      const progressFill = document.getElementById("payment-progress-fill");
      const percentLabel = document.getElementById("payment-percent-label");

      const payingCount = getPayingPassengersCount();
      const started = getStartedPassengersCount();
      const full = getFullPassengersCount();

      const paidValue = getTripPaidValue();
      const rawPercent =
        TRIP_TOTAL_VALUE > 0 ? (paidValue / TRIP_TOTAL_VALUE) * 100 : 0;
      const percent = clamp(Math.round(rawPercent), 0, 100);

      startedLabel.textContent = `${started} / ${payingCount}`;
      fullLabel.textContent = `${full}`;
      smallPercentLabel.textContent = percent + "%";
      progressFill.style.width = percent + "%";
      percentLabel.textContent = percent + "%";
    }

    function updateTimePanel() {
      const tripDateLabel = document.getElementById("trip-date-label");
      const daysRemainingLabel = document.getElementById(
        "days-remaining-label"
      );
      const planningWindowLabel = document.getElementById(
        "planning-window-label"
      );
      const timeFill = document.getElementById("time-progress-fill");
      const timePercentLabel = document.getElementById("time-percent-label");

      const today = new Date();

      const totalMs = TRIP_START_DATE - PLANNING_START_DATE;
      const elapsedMs = today - PLANNING_START_DATE;

      const totalDays = totalMs / msPerDay;
      const elapsedDays = clamp(elapsedMs / msPerDay, 0, totalDays);
      const remainingDays = Math.max(
        Math.ceil((TRIP_START_DATE - today) / msPerDay),
        0
      );

      const percent =
        totalDays > 0
          ? clamp(Math.round((elapsedDays / totalDays) * 100), 0, 100)
          : 0;

      tripDateLabel.textContent =
        TRIP_START_DATE.toLocaleDateString("pt-BR") +
        " a " +
        TRIP_END_DATE.toLocaleDateString("pt-BR");

      daysRemainingLabel.textContent =
        remainingDays === 0
          ? "Chegou o grande dia!"
          : `${remainingDays} ${remainingDays === 1 ? "dia" : "dias"}`;

      planningWindowLabel.textContent =
        PLANNING_START_DATE.toLocaleDateString("pt-BR") +
        " ‚Üí " +
        TRIP_START_DATE.toLocaleDateString("pt-BR");

      timeFill.style.width = percent + "%";
      timePercentLabel.textContent = percent + "%";
    }

    // ===============================
    // TABELA DE PASSAGEIROS
    // ===============================

    function buildPassengerTable() {
      const tbody = document.getElementById("passenger-table-body");
      const summary = document.getElementById("passenger-summary");

      tbody.innerHTML = "";
      summary.innerHTML = "";

      const totalPassengers = passengers.length;
      const totalLap = passengers.filter((p) => p.category === "childLap").length;
      const totalSeatChildren = passengers.filter((p) => p.category === "childSeat").length;
      const totalAdults = passengers.filter((p) => p.category === "adult").length;
      const totalSeats = totalPassengers - totalLap;
      const totalStarted = getStartedPassengersCount();
      const totalFull = getFullPassengersCount();
      const markedSeats = passengers.filter(
        (p) => getInstallments(p) >= MAX_INSTALLMENTS && p.seat
      ).length;

      const pieces = [
        `üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ${totalPassengers} passageiros`,
        `üßë ${totalAdults} adulto(s)`,
        `üßí ${totalSeatChildren} crian√ßa(s) em poltrona`,
        `üë∂ ${totalLap} crian√ßa(s) no colo`,
        `ü™ë ${totalSeats} poltronas`,
        `‚úÖ ${totalStarted} com pagamento iniciado`,
        `üíØ ${totalFull} totalmente quitado(s)`,
        `üéüÔ∏è ${markedSeats} poltrona(s) marcadas (quitados)`,
      ];

      pieces.forEach((text) => {
        const span = document.createElement("span");
        span.textContent = text;
        summary.appendChild(span);
      });

      passengers.forEach((p, index) => {
        const tr = document.createElement("tr");

        const installments = getInstallments(p);

        const positionTd = document.createElement("td");
        positionTd.textContent = index + 1;

        const nameTd = document.createElement("td");
        const iconSpan = document.createElement("span");
        iconSpan.textContent = getPassengerIcon(p);
        iconSpan.style.marginRight = "4px";
        nameTd.appendChild(iconSpan);
        nameTd.appendChild(document.createTextNode(p.name));

        const typeTd = document.createElement("td");
        let perfilText;
        if (p.category === "childLap") {
          perfilText = "Crian√ßa / Colo";
        } else if (p.category === "childSeat") {
          perfilText = "Crian√ßa / Poltrona";
        } else {
          perfilText = "Adulto / Poltrona";
        }
        typeTd.textContent = perfilText;

        const statusTd = document.createElement("td");
        statusTd.classList.add("status");
        const statusPill = document.createElement("span");
        statusPill.classList.add("status-pill");
        statusPill.classList.add(installments > 0 ? "paid" : "pending");
        const dot = document.createElement("span");
        dot.classList.add("dot");
        statusPill.appendChild(dot);

        let statusText;
        if (installments >= MAX_INSTALLMENTS) {
          statusText = "Confirmado (quitado)";
        } else if (installments > 0) {
          statusText = "Confirmado (em parcelas)";
        } else {
          statusText = "Pendente";
        }

        statusPill.appendChild(document.createTextNode(statusText));
        statusTd.appendChild(statusPill);

        const installmentsTd = document.createElement("td");
        installmentsTd.textContent = `${installments} / ${MAX_INSTALLMENTS}`;

        const seatTd = document.createElement("td");
        if (p.category === "childLap") {
          seatTd.textContent = "No colo (sem poltrona)";
        } else if (installments < MAX_INSTALLMENTS) {
          seatTd.textContent = "Ap√≥s quita√ß√£o";
        } else if (p.seat) {
          seatTd.textContent = "Poltrona " + p.seat;
        } else {
          seatTd.textContent = "Dispon√≠vel para escolha";
        }

        tr.appendChild(positionTd);
        tr.appendChild(nameTd);
        tr.appendChild(typeTd);
        tr.appendChild(statusTd);
        tr.appendChild(installmentsTd);
        tr.appendChild(seatTd);

        tbody.appendChild(tr);
      });
    }

    // ===============================
    // ASSENTOS
    // ===============================

    let selectedPassengerIndex = null;

    const upperLayout = [
      [1, 2, 4, 3],
      [5, 6, 8, 7],
      [9, 10, 12, 11],
      [13, 14, null, null],   // escada
      [15, 16, 20, 19],
      [17, 18, 24, 23],
      [21, 22, 28, 27],
      [25, 26, 32, 31],
      [29, 30, 36, 35],
      [33, 34, 40, 39],
      [37, 38, 44, 43],
      [41, 42, 48, 47],
      [45, 46, null, null],   // frigobar
    ];

    const lowerLayout = [
      [49, 50, null, 51],
      [52, 53, null, 54],
      [55, 56, null, 57],
    ];

    function findPassengerBySeat(seatNumber) {
      const sn = String(seatNumber);
      return passengers.findIndex((p) => p.seat && String(p.seat) === sn);
    }

    function updateSeatPassengerSelect() {
      const select = document.getElementById("seat-passenger-select");
      const helper = document.getElementById("seat-helper-text");
      if (!select || !helper) return;

      const previous = select.value;
      select.innerHTML = "";
      const defaultOpt = document.createElement("option");
      defaultOpt.value = "";
      defaultOpt.textContent = "Nenhum selecionado";
      select.appendChild(defaultOpt);

      const eligible = [];
      passengers.forEach((p, idx) => {
        if (p.seatType === "Colo") return;
        if (getInstallments(p) < MAX_INSTALLMENTS) return;
        eligible.push({ idx, name: p.name });
      });

      eligible.forEach((e) => {
        const opt = document.createElement("option");
        opt.value = String(e.idx);
        opt.textContent = e.name;
        select.appendChild(opt);
      });

      if (eligible.length === 0) {
        helper.textContent =
          "A escolha de poltronas ser√° liberada ap√≥s a quita√ß√£o (10 parcelas).";
        select.value = "";
        selectedPassengerIndex = null;
      } else {
        helper.textContent =
          "Selecione um passageiro quitado e clique em uma poltrona livre.";
        if (previous && eligible.some((e) => String(e.idx) === previous)) {
          select.value = previous;
          selectedPassengerIndex = Number(previous);
        } else {
          select.value = "";
          selectedPassengerIndex = null;
        }
      }

      select.onchange = function () {
        if (this.value === "") {
          selectedPassengerIndex = null;
        } else {
          selectedPassengerIndex = Number(this.value);
        }
        buildSeatLayout();
      };
    }

    function createSeatElement(seatNumber) {
      const seatEl = document.createElement("button");
      seatEl.type = "button";
      seatEl.className = "seat";
      seatEl.dataset.number = seatNumber;

      const occupantIdx = findPassengerBySeat(seatNumber);
      if (occupantIdx >= 0) {
        seatEl.classList.add("occupied");
        const name = passengers[occupantIdx].name;
        seatEl.title = "Ocupado por " + name;
        if (selectedPassengerIndex === occupantIdx) {
          seatEl.classList.add("mine");
        }
      } else {
        seatEl.classList.add("free");
        seatEl.title = "Livre";
      }

      seatEl.textContent = seatNumber;
      seatEl.addEventListener("click", onSeatClick);
      return seatEl;
    }

    function buildSeatLayout() {
      buildUpperDeck();
      buildLowerDeck();
    }

    function buildUpperDeck() {
      const container = document.getElementById("seat-grid-upper");
      if (!container) return;
      container.innerHTML = "";

      upperLayout.forEach((row) => {
        row.forEach((cell) => {
          if (cell == null) {
            const gap = document.createElement("div");
            gap.className = "seat-gap";
            container.appendChild(gap);
          } else {
            container.appendChild(createSeatElement(cell));
          }
        });
      });
    }

    function buildLowerDeck() {
      const container = document.getElementById("seat-grid-lower");
      if (!container) return;
      container.innerHTML = "";

      lowerLayout.forEach((row) => {
        row.forEach((cell) => {
          if (cell == null) {
            const gap = document.createElement("div");
            gap.className = "seat-gap";
            container.appendChild(gap);
          } else {
            container.appendChild(createSeatElement(cell));
          }
        });
      });
    }

    function onSeatClick(event) {
      const seatNumber = Number(event.currentTarget.dataset.number);
      if (!Number.isFinite(seatNumber)) return;

      if (selectedPassengerIndex === null) {
        alert(
          "Selecione primeiro um passageiro quitado no campo acima para atribuir a poltrona."
        );
        return;
      }

      const selectedPassenger = passengers[selectedPassengerIndex];

      if (selectedPassenger.category === "childLap") {
        alert("Passageiros que v√£o no colo n√£o t√™m poltrona atribu√≠da.");
        return;
      }

      if (getInstallments(selectedPassenger) < MAX_INSTALLMENTS) {
        alert(
          "Este passageiro ainda n√£o est√° quitado. A poltrona s√≥ pode ser marcada ap√≥s as 10 parcelas."
        );
        return;
      }

      const currentOwnerIdx = findPassengerBySeat(seatNumber);

      if (currentOwnerIdx >= 0 && currentOwnerIdx !== selectedPassengerIndex) {
        const ownerName = passengers[currentOwnerIdx].name;
        const confirmChange = confirm(
          `A poltrona ${seatNumber} j√° est√° atribu√≠da a ${ownerName}. Deseja mover para ${selectedPassenger.name}?`
        );
        if (!confirmChange) return;
        passengers[currentOwnerIdx].seat = "";
      }

      if (selectedPassenger.seat && selectedPassenger.seat !== seatNumber) {
        selectedPassenger.seat = "";
      }

      selectedPassenger.seat = String(seatNumber);

      savePassengersToStorage();
      buildPassengerTable();
      buildSeatLayout();
    }

    // ===============================
    // MAPA
    // ===============================

    function initMap() {
      const mapElement = document.getElementById("trip-map");
      if (!mapElement || typeof L === "undefined") return;

      const stops = [
        { id: "bsb", name: "Bras√≠lia (DF)", coords: [-15.79389, -47.88278] },
        { id: "for", name: "Fortaleza (CE)", coords: [-3.73186, -38.52667] },
        { id: "bom", name: "Bom Sucesso (PB)", coords: [-7.18333, -36.3667] },
        { id: "mac", name: "Macei√≥ (AL)", coords: [-9.66583, -35.735] },
      ];

      const segments = [
        { from: "bsb", to: "for", date: "08/01/2027 ‚Ä¢ 18h", label: "Bras√≠lia ‚Üí Fortaleza" },
        { from: "for", to: "bom", date: "13/01/2027", label: "Fortaleza ‚Üí Bom Sucesso" },
        { from: "bom", to: "mac", date: "17/01/2027", label: "Bom Sucesso ‚Üí Macei√≥" },
        { from: "mac", to: "bsb", date: "22/01/2027", label: "Macei√≥ ‚Üí Bras√≠lia" },
      ];

      const map = L.map("trip-map", { scrollWheelZoom: false }).setView(
        [-10, -40],
        4.5
      );

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 18,
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      const stopById = {};
      const latlngsAll = [];

      stops.forEach((stop) => {
        stopById[stop.id] = stop;
        const marker = L.circleMarker(stop.coords, {
          radius: 6,
          weight: 2,
          color: "#f97316",
          fillColor: "#facc15",
          fillOpacity: 0.9,
        }).addTo(map);
        marker.bindPopup(`<strong>${stop.name}</strong>`);
        latlngsAll.push(stop.coords);
      });

      segments.forEach((seg, idx) => {
        const from = stopById[seg.from];
        const to = stopById[seg.to];
        if (!from || !to) return;

        const polyline = L.polyline([from.coords, to.coords], {
          weight: 4,
          color: idx % 2 === 0 ? "#22c55e" : "#0ea5e9",
          opacity: 0.9,
        }).addTo(map);

        polyline.bindPopup(
          `<strong>${seg.label}</strong><br>${seg.date}`
        );
      });

      map.fitBounds(latlngsAll, { padding: [16, 16] });
    }

    // ===============================
    // INICIALIZA√á√ÉO
    // ===============================

    function initAfterPassengersLoaded() {
      loadPassengersFromStorage();
      updateHero();
      updateTripInfoCard();
      updatePaymentPanel();
      updateTimePanel();
      buildPassengerTable();
      updateSeatPassengerSelect();
      buildSeatLayout();
      initMap();
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadPassengersFromCSV()
        .then(() => {
          initAfterPassengersLoaded();
        })
        .catch((err) => {
          console.warn(
            "Erro ao carregar passageiros.csv; verifique se o arquivo est√° na mesma pasta.",
            err
          );
          passengers = [];
          initAfterPassengersLoaded();
        });
    });
  </script>
</body>
</html>
